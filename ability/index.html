<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ability SMP - Live</title>
  <link rel="icon" href="Slayer_MC_Logo.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* --- CSS VARIABLES & RESET --- */
    :root {
      --primary: #2ecc71; --secondary: #3498db; --danger: #e74c3c;
      --dark: #2c3e50; --light: #ecf0f1;
      --bg-gradient: linear-gradient(135deg, rgba(26, 42, 108, 0.9), rgba(0, 0, 0, 0.8));
      --glass: rgba(16, 20, 30, 0.7); --glass-border: rgba(255, 255, 255, 0.1);
      --font-mc: 'Courier New', monospace; /* Fallback for Minecraft font */
    }
    @font-face { font-family: 'Minecraft'; src: url('https://db.onlinewebfonts.com/t/6ab539c6fc2b21ff0b149b3d06d7f97c.woff2') format('woff2'); }
    * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }
    body { font-family: 'Poppins', sans-serif; background: url('https://wallpapercave.com/wp/wp2586787.jpg') fixed center/cover; color: var(--light); overflow-x: hidden; }
    body::before { content: ''; position: fixed; inset: 0; background: var(--bg-gradient); z-index: -1; }
    ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #111; } ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; }
    
    /* --- ANIMATIONS --- */
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulseG { 0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(46, 204, 113, 0); } 100% { box-shadow: 0 0 0 0 transparent; } }
    @keyframes pulseR { 0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); } 100% { box-shadow: 0 0 0 0 transparent; } }
    @keyframes float { 0% { transform: translateY(100vh) rotate(0deg); } 100% { transform: translateY(-100px) rotate(360deg); } }

    /* --- LAYOUT --- */
    .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; animation: fadeUp 0.6s ease; }
    header { background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); padding: 15px 0; border-bottom: 1px solid var(--glass-border); position: sticky; top: 0; z-index: 999; }
    .header-inner { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: auto; padding: 0 20px; }
    .logo-img { height: 45px; transition: 0.3s; } .logo-img:hover { transform: scale(1.1) rotate(-5deg); }
    h1 { font-family: 'Minecraft', var(--font-mc); text-shadow: 0 0 10px var(--primary); letter-spacing: 1px; }
    
    /* --- NAVIGATION --- */
    .nav { display: flex; justify-content: center; background: rgba(0,0,0,0.5); border-radius: 12px; margin-bottom: 30px; backdrop-filter: blur(5px); overflow-x: auto; }
    .tab { padding: 15px 25px; cursor: pointer; color: rgba(255,255,255,0.6); font-weight: 600; white-space: nowrap; transition: 0.3s; position: relative; }
    .tab:hover, .tab.selected { color: #fff; }
    .tab.selected::after { content: ''; position: absolute; bottom: 0; left: 20%; width: 60%; height: 3px; background: var(--primary); border-radius: 3px; }
    
    /* --- CONTENT SECTIONS --- */
    .section { display: none; padding: 30px; background: var(--glass); border: 1px solid var(--glass-border); border-radius: 16px; backdrop-filter: blur(12px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    .section.active { display: block; animation: fadeUp 0.4s ease; }
    .sec-title { text-align: center; color: var(--primary); font-size: 2rem; margin-bottom: 30px; position: relative; }
    .sec-title::after { content:''; display: block; width: 60px; height: 3px; background: var(--primary); margin: 10px auto; border-radius: 2px; }

    /* --- LIVE BRIDGE UI --- */
    .status-banner { background: rgba(0,0,0,0.3); padding: 25px; border-radius: 12px; border: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .status-left { display: flex; gap: 20px; align-items: center; }
    .pulse-dot { width: 14px; height: 14px; border-radius: 50%; position: relative; }
    .pulse-dot::after { content:''; position: absolute; inset:0; border-radius: 50%; animation: pulseG 2s infinite; opacity: 0.6; }
    .online .pulse-dot { background: var(--primary); } .online .pulse-dot::after { animation: pulseG 2s infinite; }
    .offline .pulse-dot { background: var(--danger); } .offline .pulse-dot::after { animation: pulseR 2s infinite; }
    
    .badges { display: flex; gap: 10px; margin-top: 5px; opacity: 0; transition: 0.3s; }
    .badge { background: rgba(255,255,255,0.05); padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; border: 1px solid var(--glass-border); display: flex; align-items: center; gap: 6px; }
    .pill { background: rgba(0,0,0,0.3); padding: 8px 15px; border-radius: 8px; border: 1px dashed var(--secondary); color: var(--secondary); font-family: var(--font-mc); letter-spacing: 1px; }

    .bridge-grid { display: grid; grid-template-columns: 260px 1fr; gap: 20px; height: 500px; }
    .panel { background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
    .panel-head { padding: 15px; background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--glass-border); font-weight: 600; display: flex; justify-content: space-between; }
    
    /* Player List */
    .p-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
    .p-item { display: flex; align-items: center; gap: 10px; padding: 8px; background: rgba(255,255,255,0.02); margin-bottom: 5px; border-radius: 6px; transition: 0.2s; }
    .p-item:hover { background: rgba(255,255,255,0.08); }
    .p-head { width: 32px; height: 32px; border-radius: 4px; background: #000; }

    /* Chat */
    .chat-box { flex-grow: 1; padding: 20px; overflow-y: auto; background: rgba(0,0,0,0.2); font-family: var(--font-mc); font-size: 0.9rem; line-height: 1.5; }
    .chat-msg { margin-bottom: 8px; word-break: break-word; }
    .tag { font-size: 0.7rem; padding: 2px 5px; border-radius: 4px; margin-right: 6px; font-weight: bold; border: 1px solid currentColor; }
    .tag.web { color: var(--secondary); background: rgba(52, 152, 219, 0.1); }
    .tag.game { color: var(--primary); background: rgba(46, 204, 113, 0.1); }
    
    .input-area { padding: 15px; border-top: 1px solid var(--glass-border); display: flex; gap: 10px; background: rgba(255,255,255,0.02); }
    .inp { background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: #fff; padding: 10px; border-radius: 6px; outline: none; transition: 0.3s; }
    .inp:focus { border-color: var(--primary); }
    .btn { background: var(--primary); border: none; color: #fff; padding: 0 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
    .btn:hover { background: #27ae60; }

    /* --- CARDS (Abilities/Rules) --- */
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .card { background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); padding: 20px; border-radius: 10px; transition: 0.3s; cursor: pointer; }
    .card:hover { transform: translateY(-5px); border-color: var(--primary); }
    .card-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .type-badge { background: var(--primary); font-size: 0.7rem; padding: 2px 8px; border-radius: 8px; }
    
    /* --- MOBILE --- */
    @media (max-width: 768px) {
        .bridge-grid { grid-template-columns: 1fr; height: auto; }
        .panel.players { height: 200px; order: 2; }
        .panel.chat { height: 400px; order: 1; }
        .header-inner { flex-direction: column; gap: 10px; }
        .nav { justify-content: flex-start; }
    }

    /* Background Particles */
    .bg-block { position: fixed; width: 30px; height: 30px; background-size: cover; opacity: 0.3; animation: float 20s linear infinite; z-index: -2; pointer-events: none; }
  </style>
</head>
<body>

  <!-- Floating Background Elements -->
  <div id="bg-container"></div>

  <header>
    <div class="header-inner">
      <div style="display:flex; align-items:center"><img src="Slayer_MC_Logo.png" class="logo-img" alt="Logo"></div>
      <div style="text-align:center"><h1>Ability SMP</h1><p style="opacity:0.8; font-size:0.9rem">Ultimate Minecraft Experience</p></div>
      <div style="display:flex; gap:15px">
        <a href="#" target="_blank"><i class="fab fa-youtube fa-lg" style="color:#fff"></i></a>
        <a href="https://discord.gg/4PVS2eszVn" target="_blank"><i class="fab fa-discord fa-lg" style="color:#fff"></i></a>
      </div>
    </div>
  </header>

  <div class="container">
    <nav class="nav">
      <div class="tab selected" onclick="switchTab('home')">Home</div>
      <div class="tab" onclick="switchTab('live')">Live Bridge</div>
      <div class="tab" onclick="switchTab('abilities')">Abilities</div>
      <div class="tab" onclick="switchTab('rules')">Rules</div>
      <div class="tab" onclick="switchTab('news')">News</div>
    </nav>

    <!-- HOME -->
    <div id="home" class="section active">
      <h2 class="sec-title">Welcome</h2>
      <div class="grid">
        <div class="card" style="text-align:center"><i class="fas fa-magic fa-2x" style="color:var(--primary); margin-bottom:10px"></i><h3>Abilities</h3><p>Custom powers for every player.</p></div>
        <div class="card" style="text-align:center"><i class="fas fa-comments fa-2x" style="color:var(--secondary); margin-bottom:10px"></i><h3>Live Chat</h3><p>Talk to the server from here!</p></div>
        <div class="card" style="text-align:center"><i class="fas fa-shield-alt fa-2x" style="color:var(--danger); margin-bottom:10px"></i><h3>Events</h3><p>Regular battles and rewards.</p></div>
      </div>
    </div>

    <!-- LIVE BRIDGE -->
    <div id="live" class="section">
      <h2 class="sec-title">Server Bridge</h2>
      
      <div class="status-banner" id="status-banner">
        <div class="status-left">
          <div class="pulse-dot"></div>
          <div>
            <h3 id="status-text" style="line-height:1; margin-bottom:5px">CONNECTING...</h3>
            <div class="badges" id="badges">
              <div class="badge"><i class="fas fa-users"></i> <span id="p-count">0</span></div>
              <div class="badge"><i class="fas fa-microchip"></i> <span id="tps-count">20.0</span> TPS</div>
            </div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-size:0.7rem; color:#aaa; margin-bottom:4px">SERVER IP</div>
          <div class="pill">just.ask.owner</div>
        </div>
      </div>

      <div class="bridge-grid">
        <!-- Players -->
        <div class="panel players">
          <div class="panel-head"><span>Online</span> <span class="badge" style="background:var(--primary); color:#000" id="list-count">0</span></div>
          <div class="p-list" id="p-list"><div style="text-align:center; color:#aaa; padding:20px">Offline</div></div>
        </div>
        <!-- Chat -->
        <div class="panel chat">
          <div class="panel-head"><span><i class="fas fa-comments"></i> Server Chat</span></div>
          <div class="chat-box" id="chat-box"><div style="text-align:center; color:#555; margin-top:20px">Connecting to feed...</div></div>
          <div class="input-area">
            <input type="text" id="w-user" class="inp" placeholder="Name" style="width:30%">
            <input type="text" id="w-msg" class="inp" placeholder="Message..." style="flex:1">
            <button class="btn" onclick="sendMsg()"><i class="fas fa-paper-plane"></i></button>
          </div>
        </div>
      </div>
    </div>

    <!-- DYNAMIC CONTENT (Abilities/Rules/News) -->
    <div id="abilities" class="section"><h2 class="sec-title">Abilities</h2><div id="cont-abilities" class="grid"></div></div>
    <div id="rules" class="section"><h2 class="sec-title">Rules</h2><div id="cont-rules" style="display:grid; gap:10px"></div></div>
    <div id="news" class="section"><h2 class="sec-title">News</h2><div id="cont-news"></div></div>
  </div>

  <!-- FIREBASE & LOGIC -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script>
    // --- 1. CONFIG ---
    const fbCfg = {
        apiKey: "AIzaSyA6sANvYoAkXHYG8MjbZl6Pyq23CNdBuzA", authDomain: "community-canvas-255fa.firebaseapp.com",
        databaseURL: "https://community-canvas-255fa-default-rtdb.firebaseio.com", projectId: "community-canvas-255fa",
        storageBucket: "community-canvas-255fa.appspot.com", messagingSenderId: "729445267995", appId: "1:729445267995:web:05da6756d66c58b9ccd6be"
    };
    firebase.initializeApp(fbCfg);
    const db = firebase.database();
    const PATHS = { root: 'Ability/minecraft', stat: 'status', chat: 'chatLogs', play: 'onlinePlayers' };
    const mcRef = db.ref(PATHS.root);

    // --- 2. BRIDGE LOGIC ---
    function initBridge() {
        // Status
        mcRef.child(PATHS.stat).on('value', snap => {
            const d = snap.val();
            const ban = document.getElementById('status-banner');
            const txt = document.getElementById('status-text');
            const bad = document.getElementById('badges');
            
            const online = d && d.online && (Date.now() - (d.timestamp||0) < 45000);
            
            if(online) {
                ban.className = 'status-banner online';
                txt.innerText = "ONLINE"; txt.style.color = "var(--primary)";
                bad.style.opacity = "1";
                document.getElementById('p-count').innerText = `${d.onlinePlayers}/${d.maxPlayers}`;
                document.getElementById('tps-count').innerText = d.tps;
            } else {
                ban.className = 'status-banner offline';
                txt.innerText = "OFFLINE"; txt.style.color = "var(--danger)";
                bad.style.opacity = "0";
                document.getElementById('list-count').innerText = "0";
                document.getElementById('p-list').innerHTML = '<div style="text-align:center; color:#aaa; padding:20px">Server Offline</div>';
            }
        });

        // Players
        mcRef.child(PATHS.play).on('value', snap => {
            if(document.getElementById('status-text').innerText === "OFFLINE") return;
            const d = snap.val() || {};
            const list = document.getElementById('p-list');
            list.innerHTML = '';
            
            const players = Object.keys(d).filter(k => k!=='count' && k!=='timestamp').map(k => ({id:k, ...d[k]}));
            document.getElementById('list-count').innerText = players.length;

            if(!players.length) list.innerHTML = '<div style="text-align:center; color:#aaa; padding:20px">No Players Online</div>';
            
            players.forEach(p => {
                const row = document.createElement('div'); row.className = 'p-item';
                row.innerHTML = `<img src="https://crafatar.com/avatars/${p.uuid}?size=32&overlay" class="p-head" onerror="this.src='https://crafatar.com/avatars/Steve?size=32'">
                                 <span style="color:${p.op?'var(--danger)':'#fff'}">${esc(p.name)}</span>`;
                list.appendChild(row);
            });
        });

        // Chat
        const chatBox = document.getElementById('chat-box');
        mcRef.child(PATHS.chat).limitToLast(50).on('child_added', snap => {
            if(chatBox.innerText.includes('Connecting')) chatBox.innerHTML = '';
            const m = snap.val();
            const isWeb = m.source === 'WEB';
            
            const div = document.createElement('div'); div.className = 'chat-msg';
            div.innerHTML = `<span class="tag ${isWeb?'web':'game'}">${isWeb?'WEB':'GAME'}</span>
                             <b style="color:${isWeb?'var(--secondary)':'var(--primary)'}">${esc(m.player)}:</b>
                             <span style="color:#ddd">${esc(m.message)}</span>`;
            
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        });
    }

    // --- 3. SEND MESSAGE ---
    function sendMsg() {
        const u = document.getElementById('w-user').value.trim();
        const m = document.getElementById('w-msg').value.trim();
        if(!u || !m) return alert("Name and Message required!");
        
        mcRef.child(PATHS.chat).push({
            player: u, message: m, source: "WEB", timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        document.getElementById('w-msg').value = '';
    }

    // --- 4. CONTENT LOADERS ---
    const loadContent = (node, id, fn) => {
        db.ref(`Ability/${node}`).on('value', s => {
            const c = document.getElementById(id);
            if(!c) return; c.innerHTML = '';
            if(!s.exists()) { c.innerHTML = '<p>Empty</p>'; return; }
            s.forEach(x => c.appendChild(fn({k:x.key, ...x.val()})));
        });
    };

    // Renderers
    const renderAb = d => {
        const el = document.createElement('div'); el.className = 'card';
        el.innerHTML = `<div class="card-head"><strong style="color:${d.color}; font-size:1.1rem">${d.name}</strong><span class="type-badge">${d.type}</span></div><p style="font-size:0.9rem; opacity:0.8">${d.description}</p>`;
        return el;
    };
    const renderRu = d => {
        const el = document.createElement('div'); el.className = 'card';
        el.innerHTML = `<strong style="color:var(--primary)">${d.title}</strong><br><span style="opacity:0.8">${d.description}</span>`;
        return el;
    };

    // --- 5. INIT & UTILS ---
    function switchTab(id) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('selected'));
        event.target.classList.add('selected');
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    const esc = t => t ? t.replace(/</g, "&lt;") : '';

    window.onload = () => {
        initBridge();
        loadContent('abilities', 'cont-abilities', renderAb);
        loadContent('rules', 'cont-rules', renderRu);
        
        // Enter key support
        document.getElementById('w-msg').addEventListener('keypress', e => { if(e.key==='Enter') sendMsg(); });

        // Background Blocks
        const bg = document.getElementById('bg-container');
        const imgs = ['https://minecraft.wiki/images/Grass_Block_JE6.png', 'https://minecraft.wiki/images/Diamond_Ore_JE6_BE6.png'];
        for(let i=0; i<15; i++) {
            const b = document.createElement('div'); b.className = 'bg-block';
            b.style.left = Math.random()*100+'%'; 
            b.style.animationDuration = (15+Math.random()*20)+'s';
            b.style.backgroundImage = `url(${imgs[i%2]})`;
            bg.appendChild(b);
        }
    };
  </script>
</body>
</html>
